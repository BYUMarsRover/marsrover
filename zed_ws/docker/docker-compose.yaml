# Created by Braden Meyers, Mar 2025
services:
  marsrover-zed:
    image: zed_ros2_l4t_36.3.0_sdk_4.2.5
    container_name: marsrover-zed-ct
    build: 
      context: .
      dockerfile: Dockerfile.custom-l4t-humble
      args:
        L4T_VERSION: l4t-r36.3.0
        ZED_SDK_MAJOR: 4
        ZED_SDK_MINOR: 2
        ZED_SDK_PATCH: 5
        L4T_MAJOR: 36
        L4T_MINOR: 3
    user: marsrover-zed
    network_mode: host
    privileged: true
    runtime: nvidia
    environment:
      NVIDIA_DRIVER_CAPABILITIES: all
      DISPLAY: ${DISPLAY} # Required for GUI applications
      QT_X11_NO_MITSHM: 1 # Required for GUI applications
    volumes:
      - ../../..:/home/marsrover-zed/zed_ws
      - /usr/local/zed/resources/:/usr/local/zed/resources/
      - /usr/local/zed/settings/:/usr/local/zed/settings/
      - /dev:/dev:rw
      - /dev/shm:/dev/shm
      - /etc/udev:/etc/udev:rw
      - /etc/localtime:/etc/localtime:ro # Syncs the container's time with the host
      - /tmp/.X11-unix:/tmp/.X11-unix # Required for GUI applications
    stdin_open: true  # Equivalent to -it in docker run
    tty: true  # Equivalent to -it in docker run
    restart: always  # Keeps the container running after exit unless you want it to be removed like with --rm
    entrypoint: ["/bin/bash"]